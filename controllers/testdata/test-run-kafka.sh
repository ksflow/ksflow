docker run --rm \
  --name ksflow-test \
  --env "BITNAMI_DEBUG=yes" \
  --env "KAFKA_ENABLE_KRAFT=yes" \
  --env "KAFKA_BROKER_ID=1" \
  --env "KAFKA_CFG_PROCESS_ROLES=broker,controller" \
  --env "KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER" \
  --env "KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=SSL:SSL,CONTROLLER:SSL" \
  --env "KAFKA_CFG_ADVERTISED_LISTENERS=SSL://localhost:9092" \
  --env "KAFKA_CFG_EARLY_START_LISTENERS=CONTROLLER" \
  --env "KAFKA_CFG_SUPER_USERS=User:CN=localhost,OU=Some Unit,O=Widgets Inc,L=Columbus,ST=Ohio,C=US;User:CN=ksflow-controller,OU=Some Unit,O=Widgets Inc,L=Columbus,ST=Ohio,C=US" \
  --env "KAFKA_CFG_LISTENERS=SSL://:9092,CONTROLLER://:9093" \
  --env "KAFKA_CFG_INTER_BROKER_LISTENER_NAME=SSL" \
  --env "KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@localhost:9093" \
  --env "KAFKA_CFG_SSL_KEYSTORE_TYPE=PKCS12" \
  --env "KAFKA_CFG_SSL_KEYSTORE_LOCATION=/opt/bitnami/kafka/config/certs/kafka.keystore.p12" \
  --env "KAFKA_CFG_SSL_KEYSTORE_PASSWORD=password" \
  --env "KAFKA_CFG_SSL_KEY_PASSWORD=password" \
  --env "KAFKA_CFG_SSL_TRUSTSTORE_TYPE=PKCS12" \
  --env "KAFKA_CFG_SSL_TRUSTSTORE_LOCATION=/opt/bitnami/kafka/config/certs/kafka.truststore.p12" \
  --env "KAFKA_CFG_SSL_TRUSTSTORE_PASSWORD=password" \
  --env "KAFKA_CFG_SSL_ENABLED_PROTOCOLS=TLSv1.2" \
  --env "KAFKA_CFG_SSL_PROTOCOL=TLSv1.2" \
  --env "KAFKA_CFG_SSL_CLIENT_AUTH=required" \
  --env "KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=false" \
  --env "KAFKA_CFG_ALLOW_EVERYONE_IF_NO_ACL_FOUND=false" \
  --env "KAFKA_CFG_AUTHORIZER_CLASS_NAME=org.apache.kafka.metadata.authorizer.StandardAuthorizer" \
  -v "$(pwd)"/certs:/opt/bitnami/kafka/config/certs/:ro \
  bitnami/kafka:3.3.1-debian-11-r19
